const _0x9fb5=['where','category','count(*)','isPublic','getRoutineById','CategoryRepository','./RepositoryBase','handleError','dateCreated','getCategoryById','getFirstRoutineByAttrs','categoryId','creator','./UserRepository','insert','updateRoutine','limit','orderBy','handleConstraintError','UserRepository','creatorId','exports','length','getRoutines','now','count','Routine','offset','whereIn','isArray'];(function(_0x4c6441,_0x9fb5a1){const _0x2ae2d6=function(_0x5a745f){while(--_0x5a745f){_0x4c6441['push'](_0x4c6441['shift']());}};_0x2ae2d6(++_0x9fb5a1);}(_0x9fb5,0xb5));const _0x2ae2=function(_0x4c6441,_0x9fb5a1){_0x4c6441=_0x4c6441-0x0;let _0x2ae2d6=_0x9fb5[_0x4c6441];return _0x2ae2d6;};const _0x347d21=_0x2ae2,RepositoryBase=require(_0x347d21('0x5'));module[_0x347d21('0x14')]=class RoutineRepository extends RepositoryBase{constructor(_0x5a745f){super(),this['db']=_0x5a745f;}async['getRoutineById'](_0x141d9d){const _0x2f8ec4=_0x347d21;return this[_0x2f8ec4('0x9')]({'id':_0x141d9d});}async[_0x347d21('0x9')](_0x184314){const _0x36ce8e=_0x347d21;try{const _0x3f46ae=await this[_0x36ce8e('0x16')](_0x184314,0x0,0x1),_0x48fb49=_0x3f46ae['results'];if(!Array[_0x36ce8e('0x1c')](_0x48fb49)||_0x48fb49[_0x36ce8e('0x15')]===0x0)return undefined;return _0x48fb49[0x0];}catch(_0x164b66){throw _0x164b66;}}async[_0x347d21('0x16')](_0x38e338,_0x91a0f5,_0x5503dc,_0x2739cb=_0x347d21('0x7'),_0x2adc88){const _0x41064f=_0x347d21;if(!this[_0x41064f('0x12')]){const _0x40b610=require(_0x41064f('0xc'));this['UserRepository']=new _0x40b610(this['db']);}if(!this[_0x41064f('0x4')]){const _0x3a7ac6=require('./CategoryRepository');this[_0x41064f('0x4')]=new _0x3a7ac6(this['db']);}try{let _0x52300b,_0x52db86;if(Array[_0x41064f('0x1c')](_0x38e338['id'])){const _0x3dcd5d=_0x38e338['id'];delete _0x38e338['id'],_0x52300b=await this['db'](_0x41064f('0x19'))['whereIn']('id',_0x3dcd5d)['where'](_0x38e338)[_0x41064f('0x1a')](_0x91a0f5)[_0x41064f('0xf')](_0x5503dc)[_0x41064f('0x10')](_0x2739cb,_0x2adc88),_0x52db86=await this['db'](_0x41064f('0x19'))[_0x41064f('0x1b')]('id',_0x3dcd5d)[_0x41064f('0x1d')](_0x38e338)['count']();}else _0x52300b=await this['db'](_0x41064f('0x19'))[_0x41064f('0x1d')](_0x38e338)[_0x41064f('0x1a')](_0x91a0f5)[_0x41064f('0xf')](_0x5503dc)[_0x41064f('0x10')](_0x2739cb,_0x2adc88),_0x52db86=await this['db'](_0x41064f('0x19'))[_0x41064f('0x1d')](_0x38e338)[_0x41064f('0x18')]();for(let _0x38d1f3=0x0;_0x38d1f3<_0x52300b[_0x41064f('0x15')];_0x38d1f3++){_0x52300b[_0x38d1f3]['isPublic']=_0x52300b[_0x38d1f3][_0x41064f('0x2')]!==0x0,_0x52300b[_0x38d1f3][_0x41064f('0xb')]=await this[_0x41064f('0x12')]['getUserPublicInfoById'](_0x52300b[_0x38d1f3][_0x41064f('0x13')]),delete _0x52300b[_0x38d1f3][_0x41064f('0x13')],_0x52300b[_0x38d1f3][_0x41064f('0x0')]=await this[_0x41064f('0x4')][_0x41064f('0x8')](_0x52300b[_0x38d1f3][_0x41064f('0xa')]),delete _0x52300b[_0x38d1f3]['categoryId'];}return{'totalCount':_0x52db86[0x0][_0x41064f('0x1')],'offset':_0x91a0f5,'limit':_0x5503dc,'orderBy':_0x2739cb,'direction':_0x2adc88,'results':_0x52300b};}catch(_0x102ea3){throw super[_0x41064f('0x6')](_0x102ea3);}}async['insertRoutine'](_0x5cb58c){const _0x2717c0=_0x347d21;try{const {name:_0xff8cda,detail:_0x32252e,isPublic:_0x1002e5,category:_0x5bb9d1,creator:_0x29702b,difficulty:_0x175648}=_0x5cb58c,_0x3914d3=await this['db'](_0x2717c0('0x19'))[_0x2717c0('0xd')]({'name':_0xff8cda,'detail':_0x32252e,'averageRating':0x0,'isPublic':_0x1002e5,'categoryId':_0x5bb9d1['id'],'creatorId':_0x29702b['id'],'difficulty':_0x175648,'dateCreated':Date[_0x2717c0('0x17')]()});if(!_0x3914d3)return undefined;return await this['getRoutineById'](_0x3914d3);}catch(_0x497f48){throw super[_0x2717c0('0x11')](_0x497f48);}}async[_0x347d21('0xe')](_0x42d26d,_0x243dbc){const _0x32e524=_0x347d21,{name:_0x152846,detail:_0x4a079c,isPublic:_0x29ed2e,category:_0x16745d,difficulty:_0x6da863}=_0x243dbc;try{const _0xd08433=await this['db'](_0x32e524('0x19'))[_0x32e524('0x1d')]({'id':_0x42d26d})['update']({'name':_0x152846,'detail':_0x4a079c,'isPublic':_0x29ed2e,'categoryId':_0x16745d['id'],'difficulty':_0x6da863});if(_0xd08433===0x0)return undefined;return await this[_0x32e524('0x3')](_0x42d26d);}catch(_0x1a4721){throw super[_0x32e524('0x11')](_0x1a4721);}}async['deleteRoutine'](_0x47b54e){const _0x2fc3b3=_0x347d21;try{return await this['db'](_0x2fc3b3('0x19'))[_0x2fc3b3('0x1d')]({'id':_0x47b54e})['delete']();}catch(_0x469f5e){throw super[_0x2fc3b3('0x6')](_0x469f5e);}}};